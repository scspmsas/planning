<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning de Projet</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo, useRef } = React;

        const translations = {
            fr: {
                projectTitle: 'Planning de Projet',
                type: 'Type',
                description: 'Description',
                start: 'Début',
                end: 'Fin',
                action: 'Action',
                story: 'Story',
                task: 'Task',
                exportJSON: 'Exporter JSON',
                importJSON: 'Importer JSON',
                exportImage: 'Exporter en image',
                addTask: 'Ajouter une tâche',
                taskCount: 'tâche(s)',
                year: 'Année',
                newTask: 'Nouvelle tâche',
                errorJSON: 'Erreur lors de la lecture du fichier JSON. Vérifiez que le fichier est valide.',
                hideColumns: 'Masquer les colonnes',
                showColumns: 'Afficher les colonnes',
                view: 'Vue',
                file: 'Fichier',
                oneYear: '1 an',
                twoYears: '2 ans',
                threeYears: '3 ans',
                months: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre']
            },
            en: {
                projectTitle: 'Project Planning',
                type: 'Type',
                description: 'Description',
                start: 'Start',
                end: 'End',
                action: 'Action',
                story: 'Story',
                task: 'Task',
                exportJSON: 'Export JSON',
                importJSON: 'Import JSON',
                exportImage: 'Export as Image',
                addTask: 'Add Task',
                taskCount: 'task(s)',
                year: 'Year',
                newTask: 'New task',
                errorJSON: 'Error reading JSON file. Please check that the file is valid.',
                hideColumns: 'Hide columns',
                showColumns: 'Show columns',
                view: 'View',
                file: 'File',
                oneYear: '1 year',
                twoYears: '2 years',
                threeYears: '3 years',
                months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
            },
            ro: {
                projectTitle: 'Planificare Proiect',
                type: 'Tip',
                description: 'Descriere',
                start: 'Început',
                end: 'Sfârșit',
                action: 'Acțiune',
                story: 'Story',
                task: 'Task',
                exportJSON: 'Exportă JSON',
                importJSON: 'Importă JSON',
                exportImage: 'Exportă ca imagine',
                addTask: 'Adaugă task',
                taskCount: 'task-uri',
                year: 'An',
                newTask: 'Task nou',
                errorJSON: 'Eroare la citirea fișierului JSON. Verificați dacă fișierul este valid.',
                hideColumns: 'Ascunde coloanele',
                showColumns: 'Arată coloanele',
                view: 'Vedere',
                file: 'Fișier',
                oneYear: '1 an',
                twoYears: '2 ani',
                threeYears: '3 ani',
                months: ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie', 'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie']
            }
        };

        // Icônes Lucide en SVG
        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const ChevronLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const FileDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <polyline points="9 15 12 18 15 15"></polyline>
            </svg>
        );

        const Eye = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
        );

        const EyeOff = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
        );

        const Menu = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Languages = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m5 8 6 6"></path>
                <path d="m4 14 6-6 2-3"></path>
                <path d="M2 5h12"></path>
                <path d="M7 2h1"></path>
                <path d="m22 22-5-10-5 10"></path>
                <path d="M14 18h6"></path>
            </svg>
        );

        const ProjectPlanner = () => {
            const [currentYear, setCurrentYear] = useState(2024);
            const [language, setLanguage] = useState('fr');
            const [projectTitle, setProjectTitle] = useState(translations['fr'].projectTitle);
            const planningRef = useRef(null);
            const fileInputRef = useRef(null);
            const [showColumns, setShowColumns] = useState(true);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [tasks, setTasks] = useState([
                {
                    id: 1,
                    type: 'Story',
                    description: 'UI and Client improvements',
                    startDate: null,
                    endDate: null,
                    color: '#60A5FA'
                },
                {
                    id: 2,
                    type: 'Task',
                    description: 'Development',
                    startDate: '2024-09-23',
                    endDate: '2024-10-21',
                    color: '#93C5FD'
                },
                {
                    id: 3,
                    type: 'Task',
                    description: 'IAT - QA testing',
                    startDate: '2024-10-22',
                    endDate: '2024-11-04',
                    color: '#93C5FD'
                },
                {
                    id: 4,
                    type: 'Task',
                    description: 'UAT',
                    startDate: '2024-11-05',
                    endDate: '2024-11-14',
                    color: '#93C5FD'
                }
            ]);

            const getWeeksInYear = (year) => {
                const lastDay = new Date(year, 11, 31);
                const week = Math.ceil((lastDay - new Date(year, 0, 1)) / (7 * 24 * 60 * 60 * 1000));
                return week;
            };

            const getWeekNumber = (date) => {
                const d = new Date(date);
                const yearStart = new Date(d.getFullYear(), 0, 1);
                const weekNumber = Math.ceil((d - yearStart) / (7 * 24 * 60 * 60 * 1000));
                return weekNumber;
            };

            const formatDate = (dateString) => {
                if (!dateString) return '';
                const date = new Date(dateString);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            };

            const generateWeekColumns = () => {
                const weeks = [];
                const totalWeeks = getWeeksInYear(currentYear);
                const t = translations[language];
                
                for (let week = 1; week <= totalWeeks; week++) {
                    const date = new Date(currentYear, 0, 1 + (week - 1) * 7);
                    const monthIndex = date.getMonth();
                    const month = t.months[monthIndex];
                    weeks.push({ week, month });
                }
                return weeks;
            };

            const getFirstTaskDate = () => {
                const dates = tasks
                    .filter(task => task.startDate)
                    .map(task => new Date(task.startDate));
                
                if (dates.length === 0) return null;
                return new Date(Math.min(...dates));
            };

            const getFilteredWeekColumns = () => {
                const allWeeks = generateWeekColumns();
                const firstDate = getFirstTaskDate();
                
                if (!firstDate || firstDate.getFullYear() !== currentYear) {
                    return allWeeks;
                }
                
                const firstWeek = getWeekNumber(firstDate);
                return allWeeks.filter(col => col.week >= firstWeek);
            };

            const weekColumns = useMemo(() => getFilteredWeekColumns(), [currentYear, tasks, language]);

            const addTask = () => {
                const startDate = new Date(currentYear, 0, 1);
                const endDate = new Date(currentYear, 0, 28);
                const t = translations[language];
                const newTask = {
                    id: Date.now(),
                    type: 'Task',
                    description: t.newTask,
                    startDate: startDate.toISOString().split('T')[0],
                    endDate: endDate.toISOString().split('T')[0],
                    color: '#60A5FA'
                };
                setTasks([...tasks, newTask]);
            };

            const deleteTask = (id) => {
                setTasks(tasks.filter(task => task.id !== id));
            };

            const updateTask = (id, field, value) => {
                setTasks(tasks.map(task => 
                    task.id === id ? { ...task, [field]: value } : task
                ));
            };

            const getTaskPosition = (task) => {
                if (!task.startDate || !task.endDate) return null;
                
                const startDate = new Date(task.startDate);
                const endDate = new Date(task.endDate);
                const startYear = startDate.getFullYear();
                const endYear = endDate.getFullYear();
                
                if (startYear !== currentYear && endYear !== currentYear) {
                    if (endYear < currentYear) return null;
                    if (startYear > currentYear) return null;
                }

                let startWeek = startYear === currentYear ? getWeekNumber(startDate) : 1;
                let endWeek = endYear === currentYear ? getWeekNumber(endDate) : 52;

                if (startYear < currentYear) startWeek = 1;
                if (endYear > currentYear) endWeek = 52;

                const firstDisplayedWeek = weekColumns.length > 0 ? weekColumns[0].week : 1;
                const adjustedStart = startWeek - firstDisplayedWeek;
                const adjustedEnd = endWeek - firstDisplayedWeek;

                const width = adjustedEnd - adjustedStart + 1;
                return { left: adjustedStart, width };
            };

            const getStoryDates = (storyIndex) => {
                const storyTasks = [];
                for (let i = storyIndex + 1; i < tasks.length; i++) {
                    if (tasks[i].type === 'Story') break;
                    if (tasks[i].type === 'Task') {
                        storyTasks.push(tasks[i]);
                    }
                }

                if (storyTasks.length === 0) {
                    return { startDate: null, endDate: null };
                }

                const startDates = storyTasks.map(t => new Date(t.startDate)).filter(d => !isNaN(d));
                const endDates = storyTasks.map(t => new Date(t.endDate)).filter(d => !isNaN(d));

                if (startDates.length === 0 || endDates.length === 0) {
                    return { startDate: null, endDate: null };
                }

                const minStart = new Date(Math.min(...startDates));
                const maxEnd = new Date(Math.max(...endDates));

                return {
                    startDate: minStart.toISOString().split('T')[0],
                    endDate: maxEnd.toISOString().split('T')[0]
                };
            };

            const exportAsImage = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const cellWidth = 40;
                const rowHeight = 48;
                const headerHeight = 80;
                const monthHeaderHeight = 24;
                const columnHeaderHeight = 32;
                const typeColWidth = 112;
                const descColWidth = 320;
                const startColWidth = 128;
                const endColWidth = 128;
                
                const totalWidth = typeColWidth + descColWidth + startColWidth + endColWidth + (weekColumns.length * cellWidth) + 20;
                const totalHeight = headerHeight + monthHeaderHeight + columnHeaderHeight + (tasks.length * rowHeight) + 20;
                
                canvas.width = totalWidth;
                canvas.height = totalHeight;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, totalWidth, totalHeight);
                
                const gradient = ctx.createLinearGradient(0, 0, totalWidth, 0);
                gradient.addColorStop(0, '#2563eb');
                gradient.addColorStop(1, '#1d4ed8');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, totalWidth, headerHeight);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 24px Arial';
                ctx.fillText(projectTitle, 20, 35);
                ctx.font = 'bold 20px Arial';
                ctx.fillText(currentYear.toString(), 20, 65);
                
                let yOffset = headerHeight;
                
                // Month header row
                ctx.fillStyle = '#f3f4f6';
                ctx.fillRect(0, yOffset, totalWidth, monthHeaderHeight);
                
                const weekStartX = typeColWidth + descColWidth + startColWidth + endColWidth;
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 11px Arial';
                
                let currentMonth = '';
                let monthStartIdx = 0;
                weekColumns.forEach((col, idx) => {
                    if (col.month !== currentMonth) {
                        if (currentMonth !== '') {
                            const monthWidth = (idx - monthStartIdx) * cellWidth;
                            const x = weekStartX + (monthStartIdx * cellWidth);
                            ctx.fillText(currentMonth, x + monthWidth / 2 - ctx.measureText(currentMonth).width / 2, yOffset + 16);
                        }
                        currentMonth = col.month;
                        monthStartIdx = idx;
                    }
                    if (idx === weekColumns.length - 1) {
                        const monthWidth = (idx - monthStartIdx + 1) * cellWidth;
                        const x = weekStartX + (monthStartIdx * cellWidth);
                        ctx.fillText(currentMonth, x + monthWidth / 2 - ctx.measureText(currentMonth).width / 2, yOffset + 16);
                    }
                });
                
                yOffset += monthHeaderHeight;
                
                ctx.fillStyle = '#f9fafb';
                ctx.fillRect(0, yOffset, totalWidth, columnHeaderHeight);
                
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('Type', 10, yOffset + 20);
                ctx.fillText('Description', typeColWidth + 10, yOffset + 20);
                ctx.fillText('Début', typeColWidth + descColWidth + 10, yOffset + 20);
                ctx.fillText('Fin', typeColWidth + descColWidth + startColWidth + 10, yOffset + 20);
                
                ctx.font = '11px Arial';
                ctx.fillStyle = '#4b5563';
                
                weekColumns.forEach((col, idx) => {
                    const x = weekStartX + (idx * cellWidth);
                    ctx.fillText(col.week.toString(), x + cellWidth/2 - 6, yOffset + 20);
                    
                    ctx.strokeStyle = '#e5e7eb';
                    ctx.beginPath();
                    ctx.moveTo(x, yOffset);
                    ctx.lineTo(x, totalHeight);
                    ctx.stroke();
                });
                
                yOffset += columnHeaderHeight;
                
                tasks.forEach((task, taskIdx) => {
                    const y = yOffset + (taskIdx * rowHeight);
                    
                    const isStory = task.type === 'Story';
                    const storyDates = isStory ? getStoryDates(taskIdx) : null;
                    const displayStartDate = isStory ? storyDates?.startDate : task.startDate;
                    const displayEndDate = isStory ? storyDates?.endDate : task.endDate;
                    
                    const taskToDisplay = isStory ? { ...task, startDate: displayStartDate, endDate: displayEndDate } : task;
                    
                    if (taskIdx % 2 === 0) {
                        ctx.fillStyle = '#ffffff';
                    } else {
                        ctx.fillStyle = '#f9fafb';
                    }
                    ctx.fillRect(0, y, totalWidth, rowHeight);
                    
                    ctx.strokeStyle = '#e5e7eb';
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(totalWidth, y);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#000000';
                    ctx.font = '13px Arial';
                    ctx.fillText(task.type, 10, y + 28);
                    
                    ctx.fillText(task.description.length > 35 ? task.description.substring(0, 35) + '...' : task.description, typeColWidth + 10, y + 28);
                    
                    ctx.fillText(displayStartDate ? formatDate(displayStartDate) : '-', typeColWidth + descColWidth + 10, y + 28);
                    
                    ctx.fillText(displayEndDate ? formatDate(displayEndDate) : '-', typeColWidth + descColWidth + startColWidth + 10, y + 28);
                    
                    const position = getTaskPosition(taskToDisplay);
                    if (position && displayStartDate && displayEndDate) {
                        const barX = weekStartX + (position.left * cellWidth);
                        const barWidth = position.width * cellWidth;
                        const barY = y + 8;
                        const barHeight = rowHeight - 16;
                        
                        ctx.fillStyle = task.color;
                        ctx.beginPath();
                        ctx.roundRect(barX + 2, barY, barWidth - 4, barHeight, 4);
                        ctx.fill();
                        
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 10px Arial';
                        const text = `${formatDate(displayStartDate)} - ${formatDate(displayEndDate)}`;
                        const textWidth = ctx.measureText(text).width;
                        if (barWidth > textWidth + 10) {
                            ctx.fillText(text, barX + (barWidth - textWidth) / 2, y + 30);
                        }
                    }
                });
                
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `${projectTitle.replace(/\s+/g, '_')}_${currentYear}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                });
            };

            const exportJSON = () => {
                const data = {
                    projectTitle,
                    currentYear,
                    language,
                    tasks
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `${projectTitle.replace(/\s+/g, '_')}_${currentYear}.json`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
            };

            const importJSON = (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                const t = translations[language];
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.projectTitle) setProjectTitle(data.projectTitle);
                        if (data.currentYear) setCurrentYear(data.currentYear);
                        if (data.tasks && Array.isArray(data.tasks)) setTasks(data.tasks);
                        if (data.language) setLanguage(data.language);
                    } catch (error) {
                        alert(t.errorJSON);
                    }
                };
                reader.readAsText(file);
                
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept=".json"
                        onChange={importJSON}
                        style={{ display: 'none' }}
                    />
                    <div className="max-w-[95vw] mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
                        <div className="bg-gradient-to-r from-blue-600 to-blue-700 p-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <Calendar size={32} className="text-white" />
                                    <input
                                        type="text"
                                        value={projectTitle}
                                        onChange={(e) => setProjectTitle(e.target.value)}
                                        className="text-2xl font-bold bg-transparent text-white border-b-2 border-transparent hover:border-white/50 focus:border-white focus:outline-none transition-colors px-2"
                                        placeholder={translations[language].projectTitle}
                                    />
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2 bg-white/20 rounded-lg px-3 py-2">
                                        <Languages className="text-white" size={20} />
                                        <select
                                            value={language}
                                            onChange={(e) => setLanguage(e.target.value)}
                                            className="bg-transparent text-white font-medium focus:outline-none cursor-pointer"
                                        >
                                            <option value="fr" className="text-gray-900">Français</option>
                                            <option value="en" className="text-gray-900">English</option>
                                            <option value="ro" className="text-gray-900">Română</option>
                                        </select>
                                    </div>
                                    <button
                                        onClick={() => setShowColumns(!showColumns)}
                                        className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors"
                                        title={showColumns ? translations[language].hideColumns : translations[language].showColumns}
                                    >
                                        {showColumns ? <Eye className="text-white" size={24} /> : <EyeOff className="text-white" size={24} />}
                                    </button>
                                    <button
                                        onClick={() => setCurrentYear(currentYear - 1)}
                                        className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors"
                                    >
                                        <ChevronLeft size={24} className="text-white" />
                                    </button>
                                    <span className="text-2xl font-bold text-white min-w-[100px] text-center">
                                        {currentYear}
                                    </span>
                                    <button
                                        onClick={() => setCurrentYear(currentYear + 1)}
                                        className="p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors"
                                    >
                                        <ChevronRight size={24} className="text-white" />
                                    </button>
                                    <button
                                        onClick={exportJSON}
                                        className="flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"
                                    >
                                        <FileDown size={20} />
                                        {translations[language].exportJSON}
                                    </button>
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors"
                                    >
                                        <Upload size={20} />
                                        {translations[language].importJSON}
                                    </button>
                                    <button
                                        onClick={exportAsImage}
                                        className="flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg transition-colors"
                                    >
                                        <Download size={20} />
                                        {translations[language].exportImage}
                                    </button>
                                    <button
                                        onClick={addTask}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors"
                                    >
                                        <Plus size={20} />
                                        {translations[language].addTask}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="flex">
                            <div className="flex-shrink-0 bg-white border-r-2 border-gray-300">
                                <div className="flex border-b-2 border-gray-200 bg-gray-50">
                                    {showColumns && <div className="w-28 p-3 font-bold text-gray-700 border-r">{translations[language].type}</div>}
                                    <div className="w-80 p-3 font-bold text-gray-700 border-r">{translations[language].description}</div>
                                    {showColumns && <div className="w-32 p-3 font-bold text-gray-700 border-r">{translations[language].start}</div>}
                                    {showColumns && <div className="w-32 p-3 font-bold text-gray-700 border-r">{translations[language].end}</div>}
                                    {showColumns && <div className="w-24 p-3 font-bold text-gray-700">{translations[language].action}</div>}
                                </div>

                                {tasks.map((task, taskIndex) => {
                                    const isStory = task.type === 'Story';
                                    const storyDates = isStory ? getStoryDates(taskIndex) : null;
                                    const displayStartDate = isStory ? storyDates?.startDate : task.startDate;
                                    const displayEndDate = isStory ? storyDates?.endDate : task.endDate;
                                    
                                    return (
                                        <div key={`fixed-${task.id}`} className="flex border-b border-gray-200 hover:bg-gray-50" style={{ height: '48px' }}>
                                            {showColumns && (
                                                <div className="w-28 p-2 border-r flex items-center justify-center">
                                                    <select
                                                        value={task.type}
                                                        onChange={(e) => updateTask(task.id, 'type', e.target.value)}
                                                        className="w-full px-2 py-1 border rounded text-sm"
                                                    >
                                                        <option value="Story">{translations[language].story}</option>
                                                        <option value="Task">{translations[language].task}</option>
                                                    </select>
                                                </div>
                                            )}
                                            <div className="w-80 p-2 border-r">
                                                <input
                                                    type="text"
                                                    value={task.description}
                                                    onChange={(e) => updateTask(task.id, 'description', e.target.value)}
                                                    className="w-full px-2 py-1 border rounded text-sm"
                                                />
                                            </div>
                                            {showColumns && (
                                                <div className="w-32 p-2 border-r">
                                                    {isStory ? (
                                                        <div className="px-2 py-1 text-sm text-gray-600 bg-gray-100 rounded border">
                                                            {displayStartDate ? formatDate(displayStartDate) : '-'}
                                                        </div>
                                                    ) : (
                                                        <input
                                                            type="date"
                                                            value={task.startDate}
                                                            onChange={(e) => updateTask(task.id, 'startDate', e.target.value)}
                                                            className="w-full px-2 py-1 border rounded text-sm"
                                                        />
                                                    )}
                                                </div>
                                            )}
                                            {showColumns && (
                                                <div className="w-32 p-2 border-r">
                                                    {isStory ? (
                                                        <div className="px-2 py-1 text-sm text-gray-600 bg-gray-100 rounded border">
                                                            {displayEndDate ? formatDate(displayEndDate) : '-'}
                                                        </div>
                                                    ) : (
                                                        <input
                                                            type="date"
                                                            value={task.endDate}
                                                            onChange={(e) => updateTask(task.id, 'endDate', e.target.value)}
                                                            className="w-full px-2 py-1 border rounded text-sm"
                                                        />
                                                    )}
                                                </div>
                                            )}
                                            {showColumns && (
                                                <div className="w-24 p-2 flex items-center justify-center">
                                                    <button
                                                        onClick={() => deleteTask(task.id)}
                                                        className="p-1 hover:bg-red-100 rounded text-red-600 transition-colors"
                                                    >
                                                        <Trash2 size={18} />
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>

                            <div className="flex-1 overflow-x-auto">
                                <div className="inline-block min-w-full">
                                    <div className="border-b-2 border-gray-200 bg-gray-50">
                                        <div className="flex flex-col">
                                            <div className="flex h-6 border-b">
                                                {weekColumns.map((col, idx) => {
                                                    const showMonth = idx === 0 || col.month !== weekColumns[idx - 1]?.month;
                                                    const monthSpan = showMonth ? weekColumns.filter((w, i) => i >= idx && w.month === col.month).length : 0;
                                                    
                                                    if (showMonth) {
                                                        return (
                                                            <div 
                                                                key={`month-${idx}`} 
                                                                className="text-xs font-bold text-gray-700 flex items-center justify-center border-l bg-gray-100"
                                                                style={{ width: `${monthSpan * 40}px` }}
                                                            >
                                                                {col.month}
                                                            </div>
                                                        );
                                                    }
                                                    return null;
                                                })}
                                            </div>
                                            <div className="flex h-8">
                                                {weekColumns.map((col, idx) => (
                                                    <div key={idx} className="relative" style={{ width: '40px' }}>
                                                        <div className="h-full flex items-center justify-center text-xs font-medium text-gray-600 border-l">
                                                            {col.week}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {tasks.map((task, taskIndex) => {
                                        const isStory = task.type === 'Story';
                                        const storyDates = isStory ? getStoryDates(taskIndex) : null;
                                        const displayStartDate = isStory ? storyDates?.startDate : task.startDate;
                                        const displayEndDate = isStory ? storyDates?.endDate : task.endDate;
                                        
                                        const taskToDisplay = isStory ? { ...task, startDate: displayStartDate, endDate: displayEndDate } : task;
                                        const position = getTaskPosition(taskToDisplay);
                                        
                                        return (
                                            <div key={`gantt-${task.id}`} className="border-b border-gray-200 hover:bg-gray-50" style={{ height: '48px' }}>
                                                <div className="relative" style={{ height: '48px' }}>
                                                    <div className="absolute inset-0 flex">
                                                        {weekColumns.map((_, idx) => (
                                                            <div
                                                                key={idx}
                                                                className="border-l"
                                                                style={{ width: '40px', height: '100%' }}
                                                            />
                                                        ))}
                                                    </div>
                                                    {position && (
                                                        <div
                                                            className="absolute top-2 bottom-2 rounded flex items-center justify-center text-white text-xs font-medium shadow-md cursor-pointer hover:opacity-90 transition-opacity"
                                                            style={{
                                                                left: `${position.left * 40}px`,
                                                                width: `${position.width * 40}px`,
                                                                backgroundColor: task.color
                                                            }}
                                                        >
                                                            {displayStartDate && displayEndDate ? `${formatDate(displayStartDate)} - ${formatDate(displayEndDate)}` : ''}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        <div className="bg-gray-50 p-4 border-t">
                            <p className="text-sm text-gray-600 text-center">
                                {tasks.length} {translations[language].taskCount} • {translations[language].year} {currentYear}
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ProjectPlanner />);
    </script>
</body>
</html>
